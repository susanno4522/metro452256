/* Update on: 26/01/2018 11:08:47 Metrofood */
"use strict";!function(t,e,i,r){var s={items:[],cookieName:"FizzmodCompareItems",cookieExpirationTime:1,events:{INIT:"Fizzmod.Compare.Initialized",ITEM_ADDED:"Fizzmod.Compare.ItemAdded",ITEM_REMOVED:"Fizzmod.Compare.ItemRemoved",ITEMS_UPDATED:"Fizzmod.Compare.ItemsUpdated"},errors:{itemIdNotDefined:"Item ID is not defined",itemIdNotFound:"Item ID was not found in 'items' array",itemAlreadyAdded:"Item ID was already found in 'items' array",noItems:"No items fount in 'items'",itemsObjectsArrayNotDefined:"'itemsObjectsArray' is not defined",itemsObjectsArrayNotAnArray:"'itemsObjectsArray' is not an array",noWantedSpecifications:"No specifications found in products"},options:{log:!1},init:function(r){var s=this,n=e.Utils.getCookie(this.cookieName);return n&&(this.items=n,this.trigger(this.events.ITEMS_UPDATED,JSON.stringify(this.items))),Array.isArray(r)&&r.length&&(this.items=r,this.trigger(this.events.ITEMS_UPDATED,JSON.stringify(this.items))),t(i).on("Fizzmod.Compare.ItemsUpdated",function(t,i){return e.Utils.setCookie(s.cookieName,i,s.cookieExpirationTime)}),this.trigger(this.events.INIT,JSON.stringify(this.items)),this},trigger:function(e,r){this.log(e),t(i).trigger(e,r)},error:function(t,e){this.log(this.errors[t]),e&&this.log("Data: "+e)},log:function(t){this.options.logs&&console.log(t)},search:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.ajax({url:"/api/catalog_system/pub/products/search/?"+e,data:i,beforeSend:function(t){for(var e in r)t.setRequestHeader(e,r[e])}})},getItems:function(){return this.items},addItem:function(t){return t?this.items.indexOf(t)!=-1?this.error("itemAlreadyAdded"):(this.items.push(t),this.trigger(this.events.ITEM_ADDED,t),this.trigger(this.events.ITEMS_UPDATED,JSON.stringify(this.items)),this.items):this.error("itemIdNotDefined")},removeItem:function(t){if(!t)return this.error("itemIdNotDefined");if(this.items.indexOf(t)==-1)return this.error("itemIdNotFound");var e=this.items.indexOf(t);return this.items.splice(e,1),this.trigger(this.events.ITEM_REMOVED,t),this.trigger(this.events.ITEMS_UPDATED,JSON.stringify(this.items)),this.items},getItemSpecifications:function(t){var e="fq=productId:"+t;return this.search(e)},getItemsSpecifications:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.items;if(!t.length)return this.error("noItems");for(var e="",i=0;i<t.length;i++)e+="fq=productId:"+t[i]+"&";return this.search(e)},cacheSpecs:{},wantedSpecs:[],groupSpecs:{},unwantedSpecs:["allSpecifications","categories","description","DescripciÃ³n","items","link","linkText","productId","productName","productReference","Info General"],compareItems:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"allSpecifications";if(!e)return this.error("itemsObjectsArrayNotDefined");if(!Array.isArray(e))return this.error("itemsObjectsArrayNotAnArray");"allSpecifications"!==i&&e.some(function(t){return!(i in t)})&&(i="allSpecifications");for(var r=0;r<e.length;r++){var s=e[r][i];if(s)for(var n=0;n<s.length;n++)this.wantedSpecs.indexOf(s[n])==-1&&this.unwantedSpecs.indexOf(s[n])==-1&&this.wantedSpecs.push(s[n]);this.wantedSpecs.indexOf("brand")==-1&&this.unwantedSpecs.indexOf("brand")==-1&&this.wantedSpecs.push("brand")}if(!this.wantedSpecs.length)return this.error("noWantedSpecifications");for(var o={},a=0;a<e.length;a++)for(var d=e[a],c=0;c<this.wantedSpecs.length;c++){var h=this.wantedSpecs[c];void 0==o[h]&&(o[h]={}),d[h]?o[h][d.productId]=d[h].toString():o[h][d.productId]=null}return t.extend(this.cacheSpecs,o),o}};e.Compare=s}(jQuery,Fizzmod,window);
