var megaCanje={ver:"1.0.57",hideAllMega:!1,showStickers:!1,isValidated:!1,showMiniSummary:!1,modeSettingData:!0,modeSandbox:!1,isPageLoaded:!1,isHTMLGralLoaded:!1,base_url:"https://api.smdigital.pe/v1/pe/cencoecommerce",img_stickers:"https://wongfood.vtexassets.com/arquivos/STICKER-KITCHEN-160x100-V1.png",datap_skus:[{sku:39210971,puntos:40,stickers:30},{sku:39210972,puntos:40,stickers:30},{sku:39210973,puntos:40,stickers:30},{sku:39210974,puntos:40,stickers:30},{sku:39210975,puntos:40,stickers:30},{sku:39210976,puntos:40,stickers:30},{sku:39210977,puntos:40,stickers:30},{sku:39210978,puntos:40,stickers:30},{sku:39210979,puntos:40,stickers:30},{sku:39210980,puntos:40,stickers:30}],datat_skus:[{sku:18209,puntos:50,stickers:30},{sku:18226,puntos:50,stickers:30},{sku:18232,puntos:50,stickers:30},{sku:14848,puntos:50,stickers:30},{sku:14679,puntos:50,stickers:30},{sku:14621,puntos:50,stickers:30}],data_auth:{client_id:"a6596ed377f648dc93a22515e0bf0fc9",username:"1709046692",password:"kK93eaEyca2Nrju"},data_dummy:{tipo_trama:"0001",punto_venta:"1129",cajera:"METROPE",id_trazabilidad:"01234567890123456789"},data_general_cart:[],handleize:function(e=""){e=(e=(e=(e=(e=(e=(e=e.replace("á","a").replace("à","a").replace("ä","a").replace("â","a").replace("Á","A").replace("À","A").replace("Â","A").replace("Ä","A").replace("ª","a").replace("å","a").replace("æ","ae")).replace("é","e").replace("è","e").replace("ë","e").replace("ê","e").replace("É","E").replace("È","E").replace("Ê","E").replace("Ë","E")).replace("í","i").replace("ì","i").replace("ï","i").replace("î","i").replace("Í","I").replace("Ì","I").replace("Ï","I").replace("Î","I")).replace("ó","o").replace("ò","o").replace("ö","o").replace("ô","o").replace("Ó","O").replace("Ò","O").replace("Ö","O").replace("Ô","O").replace("ø","o")).replace("ú","u").replace("ù","u").replace("ü","u").replace("û","u").replace("Ú","U").replace("Ù","U").replace("Û","U").replace("Ü","U")).replace("ñ","n").replace("Ñ","n")).toLowerCase();for(var t=['"',"'","\\","(",")","[","]"],a=0;a<t.length;++a)e=e.replace(t[a],"");return"-"==(e=e.replace(/\W+/g,"-")).charAt(e.length-1)&&(e=e.replace(/-+\z/,"")),"-"==e.charAt(0)&&(e=e.replace(/\A-+/,"")),e},data_loyalti_cache_get:function(e=!1){let t={nro_recargas:0,dateUpdate:(new Date).getTime()};return localStorage.getItem("megaCanjeLoyalti")&&(t=JSON.parse(localStorage.getItem("megaCanjeLoyalti"))),t.nro_recargas<=3?(e&&(t.nro_recargas++,t.dateUpdate=(new Date).getTime()),!e&&localStorage.getItem("megaCanjeLoyalti")||localStorage.setItem("megaCanjeLoyalti",JSON.stringify(t)),!0):(2===Math.round(((new Date).getTime()-t.dateUpdate)/36e5)&&(t={nro_recargas:0,dateUpdate:(new Date).getTime()},localStorage.setItem("megaCanjeLoyalti",JSON.stringify(t))),!1)},data_user_cache_get:async function(e=null){const t=this,a=(new Date).getHours(),n=(new Date).getMinutes();let s={};return!localStorage.getItem("megaCanjeUser")||11===a&&0===n?s=await t.data_user_cache_set(e):(s=JSON.parse(localStorage.getItem("megaCanjeUser")),e&&e.document!==s.document?s=await t.data_user_cache_set(e):s.dateUpdate?12!==Math.round(((new Date).getTime()-s.dateUpdate)/36e5)&&s.estado_afiliado||(s=await t.data_user_cache_set(e)):s.dateUpdate||(s=await t.data_user_cache_set(e))),s},data_user_cache_set:async function(e=null){const t=this;let a={document:e?e.document:"",documentType:e?e.documentType:"",email:e?e.email:"",documentCompose:"",isLoaded:!1,estado_afiliado:"0",dateUpdate:(new Date).getTime()};try{if(e){let n="DNI-",s=n+e.document;switch(t.handleize(e.documentType)){case"carne-de-extranjeria":const t=e.document.length>=12?e.document.substr(0,3):"";n="CDE-",s="000"===t?n+e.document.substr(3,e.document.length):n+e.document;break;case"pasaporte":const a=e.document.length>=12?e.document.substr(0,2):"";n="PAS-",s="00"===a?n+e.document.substr(2,e.document.length):n+e.document}a=await t.getUserData(s),a.document=e.document,a.documentType=e.documentType,a.email=e.email,a.documentCompose=s,a.isLoaded=!0,a.dateUpdate=(new Date).getTime()}}catch(e){console.error(e)}return localStorage.removeItem("megaCanjeUser"),localStorage.setItem("megaCanjeUser",JSON.stringify(a)),a},data_cart_cache_get:function(e=[]){var t=[],a=[],n=[];return localStorage.getItem("megaCanjeCart")&&(t=JSON.parse(localStorage.getItem("megaCanjeCart"))),e.map(((e,s)=>{let o=0;t.map(((t,a)=>{parseInt(t.id)===parseInt(e.id)&&parseInt(t.qty)===parseInt(e.quantity)&&o++})),0===o&&a.push({id:parseInt(e.id),qty:e.quantity}),n.push({id:parseInt(e.id),qty:e.quantity})})),localStorage.removeItem("megaCanjeCart"),localStorage.setItem("megaCanjeCart",JSON.stringify(n)),a},postApiData:async function(e="",t=null,a={}){let n={"Content-Type":"application/json"};t&&(t["Content-Type"]||(t["Content-Type"]="application/json"),n=t);const s=await fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:n,redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(a)});return await s.json()},getToken:async function(){const e=this;return await e.postApiData(`${e.base_url}/oauth/access_token`,e.data_auth)},getUserData:async function(e=""){const t=this;let a=null;const n=await t.getToken();if(n.access_token){const s={Authorization:`OAuth ${n.access_token}`},o={tarjeta_dni:e,tipo_trama:t.data_dummy.tipo_trama,punto_venta:t.data_dummy.punto_venta,cajera:t.data_dummy.cajera,id_trazabilidad:t.data_dummy.id_trazabilidad};a=await t.postApiData(`${t.base_url}/rest/consulta`,s,o)}return a},sendUserCanje:async function(e="",t="",a="",n="",s="",o="",i=null){const r=this;let c=null;const l=await r.getToken();if(l.access_token){let n="DNI-",d=n+t;switch(r.handleize(a)){case"carne-de-extranjeria":const e=t.substr(0,3);n="CDE-",d="000"===e?n+t.substr(3,t.length):n+t;break;case"pasaporte":const a=t.substr(0,2);n="PAS-",d="00"===a?n+t.substr(2,t.length):n+t}const u=new Date,m=u.getFullYear()+(u.getMonth()+1).toString().padStart(2,"0")+u.getDate().toString().padStart(2,"0"),p=u.getHours().toString().padStart(2,"0")+u.getMinutes().toString().padStart(2,"0"),g={Authorization:`OAuth ${l.access_token}`},f=u.getTime().toString(),h={tipo_trama:"0005",punto_venta:"1129",tarjeta_dni:d,fecha_transaccion:m,hora_transaccion:p,numero_caja:"12345",secuencia_caja:f.substring(f.length-6,f.length),cajera:"WEB",puntos_canjeados:s.toString().padStart(7,"0"),sticker_canjeados:o.toString().padStart(7,"0"),id_trazabilidad:e,id_pedido:e};try{c=await r.postApiData(`${r.base_url}/rest/canje`,g,h),console.log("canjeData",c)}catch(e){console.error(e)}"function"==typeof i&&i()}},formatViewByProduct:function(e="",t={}){const a=this;switch(e){case"PRODUCT":$(".valor-por.price-best-price").each((function(e,a){if($(a).closest(".wrapper.product-wrapper").length){var n="";t.canje.map((e=>{e.unidad.toLowerCase().includes("s/")||e.unidad.toLowerCase().includes("s /")||(n+=(""!==n?" + ":"")+`${e.unidad.includes("S/")?e.unidad+" ":""}${e.monto} ${e.unidad.includes("S/")?"":e.unidad}`)})),""!==n&&(n+=" + "+$(a).find(".skuBestPrice").text(),$(a).find(".skuBestPrice").after(`<strong class="skuCanje">${n}</strong>`),$(a).find(".skuBestPrice").remove())}}));break;case"COLLECTION":let e=[];$(".vitrine .product-item").each(((t,a)=>{e.push(parseInt($(a).attr("data-sku"))),$(a).addClass("render-verified-mega"),$(a).addClass("render-verified-mega--"+$(a).attr("data-sku"))})),Fizzmod.Catalog.searchSkuArray(e).done((function(e){$.each(e,((e,t)=>{const a=t.SkuData?void 0===t.SkuData[0]?JSON.parse(t.SkuData):JSON.parse(t.SkuData[0]):{};if(a&&a.canje&&a.canje.length>0){const e=t.items[0].itemId,n=$(`.render-verified-mega--${e}`).find(".product-prices__value.product-prices__value--best-price");let s="";a.canje.map((e=>{e.unidad.toLowerCase().includes("s/")||e.unidad.toLowerCase().includes("s /")||(s+=(""!==s?" + ":"")+`${e.unidad.includes("S/")?e.unidad+" ":""}${e.monto} ${e.unidad.includes("S/")?"":e.unidad}`)})),""!==s&&(s+=" + "+n.text(),$(`.render-verified-mega--${e}`).addClass("render-verified-mega--has-mega"),n.after(`<strong class="skuCanje">${s}</strong>`),n.remove())}}))}));break;case"PRODUCTCOMPARISSON":const n=a.modeSandbox?a.datat_skus:a.datap_skus;if(n.map((e=>parseInt(e.sku))).includes(parseInt(t.id))){const e=n.find((e=>parseInt(e.sku)===parseInt(t.id)));$(".valor-por.price-best-price").each((function(t,a){if($(a).closest(".wrapper.product-wrapper").length){var n="";n+=`${e.puntos} puntos + ${e.stickers} stickers`,n+=" + "+$(a).find(".skuBestPrice").text(),$(a).find(".skuBestPrice").after(`<strong class="skuCanje">${n}</strong>`),$(a).find(".skuBestPrice").remove()}}))}break;case"COLLECTIONCOMPARISSON":const s=a.modeSandbox?a.datat_skus:a.datap_skus,o=s.map((e=>parseInt(e.sku)));let i=[];$(".vitrine .product-item").each(((e,t)=>{o.includes(parseInt($(t).attr("data-sku")))&&i.push(parseInt($(t).attr("data-sku"))),$(t).addClass("render-verified-mega"),$(t).addClass("render-verified-mega--"+$(t).attr("data-sku"))})),i.map(((e,t)=>{const a=s.find((t=>parseInt(t.sku)===parseInt(e))),n=$(`.render-verified-mega--${a.sku}`).find(".product-prices__value.product-prices__value--best-price"),o=$(`.render-verified-mega--${a.sku}`).find(".product-prices__label"),i=$(`.render-verified-mega--${a.sku}`).find(".product-prices__label").find(".product-prices__label--discount-label");let r="";r+=`${a.puntos} puntos + ${a.stickers} stickers`,r+=" + "+n.text(),$(`.render-verified-mega--${a.sku}`).addClass("render-verified-mega--has-mega"),n.after(`<strong class="skuCanje">${r}</strong>`),n.remove(),"todo medio de pago"===i.text().toLowerCase()&&(i.remove(),o.attr("style","margin-bottom:4px;"))}));break;case"MINISUMMARY":const r=25;if($(".minicart--floating").length&&!$(".minisummary-floating").length)$(".minicart--floating").after(`\n                        <div class="minisummary-floating" style="${a.hideAllMega?"display:none!important;":""}height:${t.height}px;top:${t.top+r}px;">\n                            <div class="minisummary-wrapper">\n                                <div class="minisummary-header"></div>\n                                <div class="minisummary-body"></div>\n                            </div>\n                        </div>\n                    `),$(".minicart--floating").find(".minicart__items-wrapper").css("padding-bottom","20px");else if($(".minicart--floating").length&&$(".minisummary-floating").length){const e=(document.querySelector(".shelf-content")||document.querySelector(".product-content")).getBoundingClientRect().top,a=$("#vtex-callcenter__toolbar").height(),n=($(".minicart--floating"),$("body").hasClass("compare-active")?$(".compare-header").height():0);if(e<0){const s=Math.abs(Math.ceil(e))+10+a+n;$(".minisummary-floating").css("top",`${t.top+r+s}px`)}}}},renderPageCategory:function(){const e=this;$(".vitrine").length&&$(".vitrine .product-item").length>$(".render-verified-mega").length&&e.formatViewByProduct(megaCanje.modeSettingData?"COLLECTIONCOMPARISSON":"COLLECTION")},renderMiniSummary:async function(e=!1,t=!1,a=!1){const n=this;if(vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm&&($(".minisummary-floating").length||$(".cart-totalizers").length)){var s=vtexjs.checkout.orderForm;if((s.loggedIn||window.location.href.includes("metrofood.myvtex.com")||window.location.href.includes("metrofoodqa.myvtex.com"))&&s.clientProfileData.document&&!n.showMiniSummary){n.showMiniSummary=!0;const t=await n.data_user_cache_get({document:s.clientProfileData.document,documentType:s.clientProfileData.documentType,email:s.clientProfileData.email});if(t.estado_afiliado){$("#megaCanjeStyles").length||$("body").append(`\n                                <style id="megaCanjeStyles">\n                                    .error-tarjeta-bonus{\n                                        text-align: center;\n                                        font-size: 90%;\n                                        color: red;\n                                        width: 100%;\n                                        display: block;\n                                    }\n                                    .minisummary-floating--cart .error-tarjeta-bonus{\n                                        text-align: left;\n                                    }\n                                    .error-tarjeta-bonus a{\n                                        color: red;\n                                        font-weight: 600;\n                                        text-decoration: underline;\n                                        display: inline;\n                                    }\n                                    .refresh-mega-manually{\n                                        margin-top: 14px;\n                                        cursor: pointer;\n                                    }\n                                    .refresh-mega-manually:hover{\n                                        color: gray;\n                                    }\n                                    .refresh-mega-manually i{\n                                        font-style: normal;\n                                    }\n                                    .refresh-mega-manually span{\n                                        font-size: 90%;\n                                        text-decoration: underline;\n                                    }\n                                    .minisummary-floating .total-stickers.icon-target::after{\n                                        background-image: url(${n.img_stickers});\n                                    }\n                                    @media screen and (max-width: 1250px) and (min-width: 761px){\n                                        .minisummary-floating.minisummary-floating--cart .minisummary-body .line-bonus--all .total-puntos, \n                                        .minisummary-floating.minisummary-floating--cart .minisummary-body .line-bonus--all .total-stickers{\n                                            display: block;\n                                            width: 100%;\n                                        }\n                                        .minisummary-floating.minisummary-floating--cart .minisummary-body .line-bonus--all .total-stickers:before{\n                                            display: none;\n                                        }\n                                        .minisummary-floating.minisummary-floating--cart .total-puntos::after{\n                                            left: auto;\n                                            right: 0;\n                                        }\n                                        .minisummary-floating.minisummary-floating--cart .total-stickers::after{\n                                            left: auto;\n                                            right: -4px;\n                                        }\n                                    }\n                                </style>\n                            `);var o=[],i=[],r=!1,c=0,l=0,d="",u=n.data_loyalti_cache_get();if("1"!==t.estado_afiliado){let e=[];switch(localStorage.getItem("megaCanjeProducts")&&(e=JSON.parse(localStorage.getItem("megaCanjeProducts"))),localStorage.removeItem("megaCanjeProducts"),localStorage.removeItem("megaCanjeCart"),e.length>0&&n.removeMegaItems(e),$(".minisummary-floating").length&&$(".minisummary-floating").css("height","320px"),t.estado_afiliado){case"2":d='Cliente no afiliado en <a target="_blank" href="https://afiliacion.bonus.pe/bonusvirtual/servlet/bonus.inicio">bonus.pe</a>.';break;case"3":d='La tarjeta registrada en <a target="_blank" href="https://bonus.pe/login-web">bonus.pe</a> es inválida.';break;case"4":d='Existe un error en su registro en <a target="_blank" href="https://bonus.pe/login-web">bonus.pe</a>.';break;case"5":d='No presenta saldo en su registro en <a target="_blank" href="https://bonus.pe/login-web">bonus.pe</a>.';break;case"6":d='Cuenta no autorizada para canje.<br>Consulte en <a target="_blank" href="https://bonus.pe/login-web">bonus.pe</a>.';break;case"7":d='Su tarjeta se encuentra bloqueada.<br>Consulte en <a target="_blank" href="https://bonus.pe/login-web">bonus.pe</a>.';break;default:d="Tuvimos un inconveniente para encontrar tus datos. Por favor haz click a Actualizar."}}if(localStorage.getItem("megaCanjeProducts"))if(o=JSON.parse(localStorage.getItem("megaCanjeProducts")),i=vtexjs.checkout.orderForm.items.map((e=>parseInt(e.id))),o.map(((e,t)=>{i.includes(e.id)?e.canje&&e.canje.map((t=>{"puntos"===t.unidad.toLowerCase()&&(c+=t.monto*e.quantity),"stickers"===t.unidad.toLowerCase()&&(l+=t.monto*e.quantity),t.unidad.toLowerCase().includes("s/")&&t.monto*e.quantity})):(o.splice(t,1),r=!0)})),parseInt(t.saldo_puntos)<c||parseInt(t.saldo_stickers)<l)n.removeMegaItems(o),n.execModalAction({title:"Ha excedido el límite de su capacidad de puntos y stickers",subtitle:"Algunos productos se han retirado por haber superado la capacidad de puntos y stickers.\n                                                ",onSubmitAction:function(){$("#modalMegaAction button.modal-address__close-2").trigger("click")},onSubmitText:"Cerrar"});else{if(i.length>o.length){var m=n.modeSandbox?n.datat_skus:n.datap_skus,p=m.map((e=>parseInt(e.sku))),g=o.map((e=>parseInt(e.id)));i.map(((e,a)=>{if(p.includes(parseInt(e))&&!g.includes(parseInt(e))){var s=m[p.indexOf(parseInt(e))],i=vtexjs.checkout.orderForm.items[a];parseInt(t.saldo_puntos)<c+s.puntos*i.quantity||parseInt(t.saldo_stickers)<l+s.stickers*i.quantity?n.removeMegaItems([{id:parseInt(i.id)}]):(o.push({id:parseInt(i.id),quantity:i.quantity,refId:i.refId,reference:i.refId,seller:i.seller,canje:[{monto:s.puntos,unidad:"puntos"},{monto:s.stickers,unidad:"stickers"}]}),localStorage.removeItem("megaCanjeProducts"),localStorage.setItem("megaCanjeProducts",JSON.stringify(o)))}}))}r&&(localStorage.removeItem("megaCanjeProducts"),localStorage.setItem("megaCanjeProducts",JSON.stringify(o)))}$(".minisummary-floating").length?e&&o.length>0?(c=0,l=0,0,o.map(((e,t)=>{e.canje&&e.canje.map((t=>{"puntos"===t.unidad.toLowerCase()&&(c+=t.monto*e.quantity),"stickers"===t.unidad.toLowerCase()&&(l+=t.monto*e.quantity),t.unidad.toLowerCase().includes("s/")&&t.monto*e.quantity}))})),$(".minisummary-floating .minisummary-header").html(`\n                                    Hola <span class="bonus-name">${t.primer_nombre?t.primer_nombre:""}</span><br> ${o.length>0?"¡Tienes productos con stickers y puntos en tu carrito!:":"Tienes disponible:"} \n                                    ${""!==d?'<br><span class="error-tarjeta-bonus">'+d+"</span>":""}\n                                    ${u||""!==d?'<div class="refresh-mega-manually"><i class="font-icn refresh"></i><span>Actualizar</span></div>':""}\n                                `),$(".minisummary-floating .minisummary-body").html(`\n                                    <div class="line-bonus--all ${o.length>0?"":"hide"}">\n                                        <div class="line-bonus--text" style="color: #f01612;">Estás por canjear:</div>\n                                        <div class="total-puntos">${parseInt(c)}</div>\n                                        <div class="total-stickers icon-target" style="${n.showStickers?"":"display:none!important;"}">${parseInt(l)}</div>\n                                    </div>\n                                    <div class="line-bonus--all">\n                                        <div class="line-bonus--text">Tienes disponible:</div>\n                                        <div class="total-puntos">${t.saldo_puntos?parseInt(t.saldo_puntos):0}</div>\n                                        <div class="total-stickers icon-target" style="${n.showStickers?"":"display:none!important;"}">${t.saldo_stickers?parseInt(t.saldo_stickers):0}</div>\n                                    </div>\n                                `)):($(".minisummary-floating").addClass("minisummary-active"),$(".minisummary-floating .minisummary-header").html(`\n                                    Hola <span class="bonus-name">${t.primer_nombre?t.primer_nombre:""}</span><br>\n                                    ${""!==d?'<span class="error-tarjeta-bonus">'+d+"</span>":""}\n                                    ${u||""!==d?'<div class="refresh-mega-manually"><i class="font-icn refresh"></i><span>Actualizar</span></div>':""}\n                                `),$(".minisummary-floating .minisummary-body").html(`\n                                    <div class="line-bonus--all">\n                                        <div class="line-bonus--text">Tienes disponible:</div>\n                                        <div class="total-puntos">${t.saldo_puntos?parseInt(t.saldo_puntos):0}</div>\n                                        <div class="total-stickers icon-target" style="${n.showStickers?"":"display:none!important;"}">${t.saldo_stickers?parseInt(t.saldo_stickers):0}</div>\n                                    </div>\n                                `)):$(".cart-totalizers").length&&$(".cart-totalizers").append(`\n                                <div class="minisummary-floating minisummary-floating--cart minisummary-active" style="${n.hideAllMega?"display:none!important;":""}">\n                                    <div class="minisummary-wrapper">\n                                        <div class="minisummary-header">\n                                            Hola <span class="bonus-name">${t.primer_nombre?t.primer_nombre:""}</span><br>\n                                            ${o.length>0?"¡Tienes productos con stickers y puntos en tu carrito!:":""}\n                                            ${""!==d?'<br><span class="error-tarjeta-bonus">'+d+"</span>":""}\n                                            ${u||""!==d?'<div class="refresh-mega-manually"><i class="font-icn refresh"></i><span>Actualizar</span></div>':""}\n                                        </div>\n                                        <div class="minisummary-body">\n                                            <div class="line-bonus--all ${o.length>0?"":"hide"}">\n                                                <div class="line-bonus--text" style="color: #f01612;">Estás por canjear:</div>\n                                                <div class="total-puntos">${parseInt(c)}</div>\n                                                <div class="total-stickers icon-target" style="${n.showStickers?"":"display:none!important;"}">${parseInt(l)}</div>\n                                            </div>\n                                            <div class="line-bonus--all">\n                                                <div class="line-bonus--text">Tienes disponible:</div>\n                                                <div class="total-puntos">${t.saldo_puntos?parseInt(t.saldo_puntos):0}</div>\n                                                <div class="total-stickers icon-target" style="${n.showStickers?"":"display:none!important;"}">${t.saldo_stickers?parseInt(t.saldo_stickers):0}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            `)}}}t&&n.maskLoyalti(!1)},removeMegaItems:function(e){const t=this;var a=[],n=[],s=[],o=[];localStorage.getItem("megaCanjeProducts")&&(n=JSON.parse(localStorage.getItem("megaCanjeProducts"))),vtexjs.checkout.orderForm.items.map(((t,n)=>{e.map(((e,s)=>{parseInt(e.id)===parseInt(t.id)&&(a.push({index:n,quantity:0}),o.push(parseInt(e.id)))}))})),o.length>0&&n.map(((e,t)=>{o.includes(parseInt(e.id))||s.push(e)})),a.length>0?vtexjs.checkout.updateItems(a,null,!1).done(((e,a)=>{localStorage.removeItem("megaCanjeProducts"),s.length>0&&localStorage.setItem("megaCanjeProducts",JSON.stringify(s)),$("#cart-page").length&&(t.showMiniSummary=!1,t.renderMiniSummary($("#cart-page").length,!0))})):$("#cart-page").length&&(t.showMiniSummary=!1,t.renderMiniSummary($("#cart-page").length,!0))},maskLoyalti:function(e=!1){e?($(".mask-loyalti").remove(),$("body").append('\n                <div class="mask-loyalti">\n                    <style>\n                        .mask-loyalti{\n                            position: fixed;\n                            left: 0;\n                            top: 0;\n                            width: 100%;\n                            height: 100%;\n                            z-index: 999;\n                            display: flex;\n                            align-items: center;\n                            justify-content: center;\n                        }\n                        .mask-loyalti > div{\n                            width: 150px;\n                            height: 80px;\n                            display: flex;\n                            background-color: rgba(255,255,255,0.9);\n                            border: 1px solid rgba(0, 0, 0, 0.1);\n                            align-items: center;\n                            justify-content: center;\n                            color: rgba(0, 0, 0, 0.7);\n                            font-size: 12px;\n                        }\n                    </style>\n                    <div>Verificando puntos</div>\n                </div>\n            ')):$(".mask-loyalti").remove()},addToCartEvent:async function(e=[],t=[]){if(0===e.length)return;const a=this;var n=[],s=[],o=[],i=[];if((a.modeSandbox?a.datat_skus:a.datap_skus).map((e=>parseInt(e.sku))).includes(e[0].id))if(a.maskLoyalti(!0),localStorage.getItem("megaCanjeProducts")&&(n=JSON.parse(localStorage.getItem("megaCanjeProducts")),i=vtexjs.checkout.orderForm.items.map((e=>parseInt(e.id))),n.map(((e,t)=>{i.includes(e.id)||n.splice(t,1)})),o=n.map((e=>e.id))),await a.validateEvent(e,n,t)){e.map(((e,a)=>{o.includes(e.id)?(n[o.indexOf(e.id)].quantity=e.quantity,n[o.indexOf(e.id)].seller=e.seller):(e.canje=t[a],s.push(e),o.push(e.id))}));var r=n.concat(s);localStorage.removeItem("megaCanjeProducts"),r.length>0&&localStorage.setItem("megaCanjeProducts",JSON.stringify(r)),setTimeout((function(){a.maskLoyalti(!1)}),1e3)}else a.maskLoyalti(!1);else a.maskLoyalti(!1)},addToCartEventComparisson:async function(e=[]){if(0===e.length)return;const t=this;var a=[],n=[],s=[],o=[];const i=t.modeSandbox?t.datat_skus:t.datap_skus,r=i.map((e=>parseInt(e.sku)));if(!r.includes(e[0].id))return void t.maskLoyalti(!1);t.maskLoyalti(!0),localStorage.getItem("megaCanjeProducts")&&(a=JSON.parse(localStorage.getItem("megaCanjeProducts")),o=vtexjs.checkout.orderForm.items.map((e=>parseInt(e.id))),a.map(((e,t)=>{o.includes(e.id)||a.splice(t,1)})),s=a.map((e=>e.id)));let c=[];if(e.map(((e,t)=>{if(r.includes(parseInt(e.id))){const t=i.find((t=>parseInt(t.sku)===parseInt(e.id)));s.includes(e.id)||(c=[[{monto:t.puntos,unidad:"puntos"},{monto:t.stickers,unidad:"stickers"}]])}})),await t.validateEvent(e,a,c)){e.map(((e,t)=>{if(r.includes(parseInt(e.id))){const t=i.find((t=>parseInt(t.sku)===parseInt(e.id)));s.includes(e.id)?(a[s.indexOf(e.id)].quantity=e.quantity,a[s.indexOf(e.id)].seller=e.seller):(e.canje=[{monto:t.puntos,unidad:"puntos"},{monto:t.stickers,unidad:"stickers"}],n.push(e),s.push(e.id))}}));var l=a.concat(n);localStorage.removeItem("megaCanjeProducts"),l.length>0&&localStorage.setItem("megaCanjeProducts",JSON.stringify(l)),setTimeout((function(){t.maskLoyalti(!1)}),1e3)}else t.maskLoyalti(!1)},updateCartEvent:async function(){const e=this;if(localStorage.getItem("megaCanjeProducts")&&vtexjs.checkout&&vtexjs.checkout.orderForm){var t=(e.modeSandbox?e.datat_skus:e.datap_skus).map((e=>parseInt(e.sku))),a=e.data_cart_cache_get(vtexjs.checkout.orderForm.items),n=0;if(a.map(((e,a)=>{t.includes(e.id)&&n++})),0===n)return void e.maskLoyalti(!1);e.maskLoyalti(!0);const u=await e.data_user_cache_get({document:vtexjs.checkout.orderForm.clientProfileData.document,documentType:vtexjs.checkout.orderForm.clientProfileData.documentType,email:vtexjs.checkout.orderForm.clientProfileData.email});if(u){var s=[],o=[],i=[],r=[],c=!1,l=[];s=JSON.parse(localStorage.getItem("megaCanjeProducts")),r=s.map((e=>parseInt(e.id))),vtexjs.checkout.orderForm.items.map((e=>{if(r.includes(parseInt(e.id))){var t=s[r.indexOf(parseInt(e.id))],a=s[r.indexOf(parseInt(e.id))];a.quantity_old=parseInt(t.quantity),parseInt(t.quantity)!==parseInt(e.quantity)&&(l.push({id:t.id,qty_old:parseInt(t.quantity),qty_new:parseInt(e.quantity)}),a.quantity_old=parseInt(t.quantity)),t.quantity=parseInt(e.quantity),o.push(t),i.push(a),s[r.indexOf(parseInt(e.id))].quantity=e.quantity,c=!0}}));var d=await e.validateToUpdate(o,u,l);c&&d?(localStorage.removeItem("megaCanjeProducts"),localStorage.setItem("megaCanjeProducts",JSON.stringify(o)),e.showMiniSummary=!1,setTimeout((function(){e.renderMiniSummary($("#cart-page").length,!0)}),800)):setTimeout((function(){e.maskLoyalti(!1)}),1e3)}}},validateEvent:async function(e,t,a){const n=this;if(vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm){var s,o,i=0,r=0,c=0,l=0,d=vtexjs.checkout.orderForm,u=vtexjs.checkout.orderForm.clientProfileData;if(!d.loggedIn&&!window.location.href.includes("metrofood.myvtex.com")&&!window.location.href.includes("metrofoodqa.myvtex.com"))return n.removeNewItems(e),n.execModalAction({title:"¡Lo sentimos, no se puede agregar el producto!",subtitle:"Debes estar logueado y tener tu DNI registrado.<br>¿Quieres loguearte ahora?",onSubmitAction:function(){n.removeAllStorage(),setTimeout((function(){top.location.href=`/login?ReturnUrl=${window.location.pathname}`}),800)}}),!1;if(!u.document)return n.removeNewItems(e),n.execModalAction({title:"¡Lo sentimos, no se puede agregar el producto!",subtitle:"Se necesita su documento de identidad.<br>¿Quiere actualizarlo ahora?",onSubmitAction:function(){top.location.href="/account"}}),!1;t.map((e=>{e.canje&&e.canje.map((e=>{"puntos"===e.unidad.toLowerCase()&&(i+=e.monto),"stickers"===e.unidad.toLowerCase()&&(r+=e.monto),e.unidad.toLowerCase().includes("s/")&&e.monto}))})),a.map((e=>{e.map((e=>{"puntos"===e.unidad.toLowerCase()&&(c+=e.monto),"stickers"===e.unidad.toLowerCase()&&(l+=e.monto),e.unidad.toLowerCase().includes("s/")&&e.monto}))})),s=i+c,o=r+l;const m=await n.data_user_cache_get({document:u.document,documentType:u.documentType,email:u.email});if(m.estado_afiliado&&"3"===m.estado_afiliado)return n.removeNewItems(e),n.execModalAction({title:"¡Lo sentimos, no se puede agregar el producto!",subtitle:"Parece que no estás registrado en bonus.<br>¿Quiere afiliarte para una próxima compra?",onSubmitAction:function(){window.open("https://afiliacion.bonus.pe/bonusvirtual/servlet/bonus.inicio","_blank").focus()}}),!1;if(m.estado_afiliado&&(parseInt(m.saldo_puntos)<s||parseInt(m.saldo_stickers)<o))return n.removeNewItems(e),n.execModalAction({title:"¡Lo sentimos, no se puede agregar el producto!",subtitle:`No tienes los puntos y/o stickers suficientes en Bonus.\n                                    <div class="line-bonus">\n                                        Necesitas en total:<br>\n                                        <b>${s}</b> Puntos y <b>${o}</b> Stickers\n                                    </div>\n                                    <div class="line-bonus">\n                                        Tienes disponible:<br>\n                                        <b>${parseInt(m.saldo_puntos)}</b> Puntos y <b>${parseInt(m.saldo_stickers)}</b> Stickers\n                                    </div>\n                                    `,onSubmitAction:function(){$("#modalMegaAction button.modal-address__close-2").trigger("click")},onSubmitText:"Cerrar"}),!1}return!0},validateToUpdate:async function(e,t,a){const n=this;if(vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm){var s,o,i=0,r=0,c=vtexjs.checkout.orderForm;if(e.map((e=>{e.canje&&e.canje.map((t=>{"puntos"===t.unidad.toLowerCase()&&(i+=t.monto*parseInt(e.quantity)),"stickers"===t.unidad.toLowerCase()&&(r+=t.monto*parseInt(e.quantity)),t.unidad.toLowerCase().includes("s/")&&t.monto*parseInt(e.quantity)}))})),s=i+0,o=r+0,parseInt(t.saldo_puntos)<s||parseInt(t.saldo_stickers)<o)return n.updateItems(c,a),n.execModalAction({title:"¡Lo sentimos, no se puede incrementar la cantidad!",subtitle:`No tienes los puntos y/o stickers suficientes en Bonus.\n                                <div class="line-bonus">\n                                    Necesitas en total:<br>\n                                    <b>${s}</b> Puntos y <b>${o}</b> Stickers\n                                </div>\n                                <div class="line-bonus">\n                                    Tienes disponible:<br>\n                                    <b>${parseInt(t.saldo_puntos)}</b> Puntos y <b>${parseInt(t.saldo_stickers)}</b> Stickers\n                                </div>\n                                `,onSubmitAction:function(){window.top.location.reload()},onSubmitText:"Cerrar"}),!1}return!0},removeItemEvent:function(e){var t=localStorage.getItem("megaCanjeProducts")?JSON.parse(localStorage.getItem("megaCanjeProducts")):[];if(t.length>0){t.map((e=>{}));let a=[];t.map(((t,n)=>{parseInt(t.id)!==parseInt(e)&&a.push(t)})),localStorage.removeItem("megaCanjeProducts"),a.length>0&&localStorage.setItem("megaCanjeProducts",JSON.stringify(a))}},removeAllItemsEvent:function(){localStorage.removeItem("megaCanjeProducts")},removeAllStorage:function(){localStorage.removeItem("megaCanjeProducts"),localStorage.removeItem("megaCanjeCart"),localStorage.removeItem("megaCanjeUser"),localStorage.removeItem("megaCanjeProcess")},validaMegaCanje:async function(){const e=this;if(vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm&&!e.isValidated){e.isValidated=!0;var t=JSON.parse(localStorage.getItem("megaCanjeProducts")),a=0,n=0,s=0,o=vtexjs.checkout.orderForm,i=vtexjs.checkout.orderForm.clientProfileData;if(t.map((e=>{e.canje&&e.canje.map((e=>{"puntos"===e.unidad.toLowerCase()&&(a+=e.monto),"stickers"===e.unidad.toLowerCase()&&(n+=e.monto),"s/."===e.unidad.toLowerCase()&&(s+=e.monto)}))})),!o.loggedIn)return e.removeAllStorage(),void setTimeout((function(){top.location.href="/login?ReturnUrl=/cart"}),800);if(!i.document)return void(confirm("Se necesita su documento de identidad para proceder a una compra con stickers. Será reenviado a Mi Cuenta para poder completar su documento de identidad")&&(top.location.href="/account"));const r=await e.data_user_cache_get({document:i.document,documentType:i.documentType,email:i.email});if(r.estado_afiliado&&"1"===r.estado_afiliado)(parseInt(r.saldo_puntos)<a||parseInt(r.saldo_stickers)<n)&&alert("No tiene los puntos o stickers necesarios para procesar su compra. Se recomienda retirar los productos de canje");else if(r.estado_afiliado&&"3"===r.estado_afiliado&&confirm("Su usuario no se encuentra registrado en Bonus. Le invitamos registrarse en bonus.pe para poder procesar esta transacción"))return void(top.location.href="https://afiliacion.bonus.pe/bonusvirtual/servlet/bonus.inicio");console.log("document",r),console.log("totalPuntos",a),console.log("totalStickers",n),console.log("totalSoles",s)}},removeNewItems:function(e){var t=vtexjs.checkout.orderForm.items,a=[];t.map(((t,n)=>{e.map((e=>{parseInt(e.id)===parseInt(t.id)&&a.push({index:n,quantity:e.quantity})}))})),a.length>0&&vtexjs.checkout.removeItems(a)},updateItems:function(e,t){var a=[];return e.items.map(((e,n)=>{t.map(((t,s)=>{parseInt(t.id)===parseInt(e.id)&&a.push({index:n,quantity:t.qty_old})}))})),a.length>0?(vtexjs.checkout.updateItems(a,null,!1).done(((e,t)=>{var a=[],n=JSON.parse(localStorage.getItem("megaCanjeProducts")),s=n.map((e=>parseInt(e.id)));e.items.map((e=>{if(s.includes(parseInt(e.id))){var t=n[s.indexOf(parseInt(e.id))];t.quantity=parseInt(e.quantity),a.push(t)}})),localStorage.removeItem("megaCanjeProducts"),a.length&&localStorage.setItem("megaCanjeProducts",JSON.stringify(a))})),!0):null},execModalAction:function({title:e,subtitle:t,onSubmitAction:a,onSubmitText:n}){var s=`\n            <div class="shipping-preference__portal-place" id="modalMegaAction">\n                <style>\n                    .modal-address__close-2{\n                        position: absolute;\n                        top: 0;\n                        right: 0;\n                        background-color: #000;\n                        width: 30px;\n                        height: 30px;\n                        color: #fff;\n                        z-index: 1;\n                    }\n                    .line-bonus{\n                        margin-top: 8px;\n                    }\n                    .line-bonus:before{\n                        content: "";\n                        display: block;\n                        border-top: 1px solid #000;\n                        width: 50%;\n                        margin: 5px auto;\n                    }\n                </style>\n                <div class="shipping-preference__portal-modal">\n                    <div class="shipping-preference-overlay" style="opacity: 1; display: flex;">\n                        <div class="shipping-preference-overlay__wrapper" style="transform: scale3d(1, 1, 1);">\n                            <div class="shipping-preference-overlay__content">\n                                <div class="delivery__login" style="padding:20px 35px;">\n                                    <div class="shipping-preference__title delivery__login-title">${e}</div>\n                                    <div class="shipping-preference__subtitle delivery__login-subtitle">${t}</div>\n                                    <label for="delivery-email" class="delivery__login-label" style="display:none;">\n                                        <input type="email" id="delivery-email" name="delivery-email" title="Email" class="delivery__login-input" placeholder="mail@gmail.com" value="">\n                                    </label>\n                                    <div class="delivery__login-submit">\n                                        <button type="button" class="shipping-preference__submit">${n||"Aceptar"}</button>\n                                    </div>\n                                </div>\n                                <button type="button" class="modal-address__close-2 font-icn cross"></button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;$("#modalMegaAction").length&&$("#modalMegaAction").remove(),$(".shipping-preference__portal-place").length&&$(".shipping-preference__portal-place").each((function(){"modalMegaAction"!==$(this).attr("id")&&$(this).find(".shipping-preference-overlay").attr("style","opacity:0;display:none;")})),$("body").append(s),$("#modalMegaAction button.shipping-preference__submit").length&&a&&$("#modalMegaAction button.shipping-preference__submit").click(a),$("#modalMegaAction button.modal-address__close-2").click((function(){$(".shipping-preference__portal-place").length&&$(".shipping-preference__portal-place").each((function(){"modalMegaAction"!==$(this).attr("id")&&$(this).find(".shipping-preference-overlay").attr("style","opacity:0;display:none;")})),$("#modalMegaAction").remove()}))},evalProductGralCart:function(e={},t=!1){}};if($("#category-page").length||$("#search-results-page").length)var timeMegaCategory=setInterval((()=>{megaCanje.renderPageCategory()}),3e3);if($("#category-page").length||$("#search-results-page").length||$("#product-nonfood-page").length||$("#product-food-page").length||$("#cart-page").length)var timeMegaSummary=setInterval((()=>{megaCanje.showMiniSummary?(megaCanje.isPageLoaded=!0,clearInterval(timeMegaSummary)):megaCanje.renderMiniSummary(!1,!1,!0)}),1e3);$(window).on("orderFormUpdated.vtex",(function(e,t){if($("#cart-page").length&&megaCanje.isPageLoaded&&megaCanje.updateCartEvent(),vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm){var a=vtexjs.checkout.orderForm;if(a.loggedIn&&a.clientProfileData&&a.clientProfileData.documentType&&"DNI"!==a.clientProfileData.documentType&&megaCanje.isHTMLGralLoaded){if(0===t.items.length&&(megaCanje.data_general_cart=[]),t.items.length>0&&megaCanje.data_general_cart.length>0){var n=t.items.map((e=>e.id));megaCanje.data_general_cart.map(((e,t)=>{n.includes(e)||megaCanje.data_general_cart.splice(t,1)}))}0===megaCanje.data_general_cart.length?1===t.items.length?megaCanje.evalProductGralCart(t.items[0]):megaCanje.data_general_cart=t.items.map((e=>e.id)):t.items.map((e=>{megaCanje.data_general_cart.includes(e.id)||megaCanje.evalProductGralCart(e)}))}}})),$(document).ready((function(){setTimeout((function(){megaCanje.isHTMLGralLoaded=!0,vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm&&!vtexjs.checkout.orderForm.loggedIn&&megaCanje.removeAllStorage()}),2200)})),$(document).on("click",".refresh-mega-manually",(function(e){if(e.preventDefault(),"1"!==$(e.target).attr("data-login")&&megaCanje.data_loyalti_cache_get(!0)){$(e.target).attr("data-loading","1"),$(e.target).find("span").html("Espere...");let t=[];localStorage.getItem("megaCanjeProducts")&&(t=JSON.parse(localStorage.getItem("megaCanjeProducts"))),megaCanje.removeAllStorage(),t.length>0&&that.removeMegaItems(t),setTimeout((function(){top.location.reload()}),1500)}}));